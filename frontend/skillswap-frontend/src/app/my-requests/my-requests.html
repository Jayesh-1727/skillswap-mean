<div class="requests-page">

  <h2>My Learning Requests</h2>

  <!-- Loading -->
  <div *ngIf="requests === null" class="loading">
    Loading your requests...
  </div>

  <!-- Empty -->
  <div *ngIf="requests !== null && requests.length === 0"
       class="empty">
    You haven’t requested any sessions yet.
  </div>

  <!-- Cards -->
  <div class="request-grid"
       *ngIf="requests !== null && requests.length > 0">

    <div class="request-card"
         *ngFor="let r of requests">

      <!-- Header -->
      <div class="card-header">
        <div>
          <h3>{{ r.skill.name }}</h3>
          <p class="teacher">
            Teacher: {{ r.teacher.name }}
          </p>
        </div>

        <span class="status"
              [ngClass]="r.status">
          {{ r.status }}
        </span>
      </div>

      <!-- Chat -->
      <div *ngIf="r.status === 'accepted'"
           class="chat-section">
        <a
          class="btn chat"
          [routerLink]="['/chat', r._id]">
          Open Chat
        </a>
      </div>

      <!-- Feedback -->
      <div *ngIf="r.status === 'completed' && !r.rating"
           class="feedback-form">

        <label>Rate this session</label>

        <input #rating
               type="number"
               min="1"
               max="5"
               placeholder="1 - 5" />

        <input #review
               type="text"
               placeholder="Write a short review..." />

        <button
          class="btn submit"
          (click)="submitFeedback(r._id, +rating.value, review.value)">
          Submit Feedback
        </button>
      </div>

      <!-- Existing Rating -->
      <div *ngIf="r.rating"
           class="review">

        <div class="stars">
          <span *ngFor="let star of getStars(r.rating)">★</span>
        </div>

        <p>{{ r.review }}</p>
      </div>

    </div>

  </div>

</div>
